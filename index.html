<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>日干支 checker</title>
<style>
  :root{
    --ink:#333; --brand:#ff68b6; --white:#fff;
    /* 入力見た目の共通トークン（ここをいじれば年月・日の見た目を一括調整） */
    --field-fg:#555;                 /* 数字や「年」の色（グレー系） */
    --field-font-size:16px;          /* フォントサイズ */
    --field-font-weight:400;         /* 太さ（400〜600でお好み） */
    --field-border:#cfd6e0;          /* 枠線色 */
    --field-pad-v:6px;               /* 縦パディング */
    --field-pad-h:8px;               /* 横パディング */
    --field-radius:8px;              /* 角丸 */
    --caret-color:#7aa8ff;           /* ▼の色 */
    /* カレンダーへボタン（チェッカー→カレンダー） */
    --nav-btn-bg:#3b66bce2; --nav-btn-fg:#fff;
    /* OFUSEの固定位置（距離を調整したい場合ここを変える） */
    --support-offset: 10px;
  }

  html,body{ margin:0; padding:0; height:100%; -webkit-text-size-adjust:100%; color:var(--ink); }
  body{
    font-family:'Hiragino Kaku Gothic ProN', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
    text-align:center;
    background:url('iloiloback.jpg') no-repeat center/cover;
  }
  .wrap{
    min-height:100svh; padding:24px 16px calc(24px + env(safe-area-inset-bottom));
    display:flex; flex-direction:column; justify-content:center; align-items:center; gap:16px;
  }

  /* 丸カード */
  .card{
    background:rgba(255,255,255,.6);
    border-radius:50%;
    width:260px; height:260px;
    box-shadow:0 8px 24px rgba(0,0,0,.1);
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    padding:18px;
  }

  /* ロゴ & サブタイトル（Futura風） */
  .logo{
    font-family:'Futura','Avenir Next','Montserrat',sans-serif;
    font-weight:900; font-size:34px; letter-spacing:.02em; margin:0;
  }
  .sub{
    font-family:'Futura','Avenir Next','Montserrat',sans-serif;
    font-weight:400; font-size:17px; margin:2px 0 0;
  }

  /* 入力行 */
  .row{ display:flex; gap:6px; align-items:center; justify-content:center; margin-top:10px; }

  /* ベースselect（“日”に適用。年月は見せラベル方式） */
  select{
    appearance:none; -webkit-appearance:none; outline:none;
    font-size:var(--field-font-size);
    font-weight:var(--field-font-weight);
    color:var(--field-fg);
    border:1px solid var(--field-border);
    background:rgba(255,255,255,.96);
    border-radius:var(--field-radius);
    padding:var(--field-pad-v) calc(var(--field-pad-h) + 14px) var(--field-pad-v) var(--field-pad-h);
    line-height:1.1;
  }
  .sel{ position:relative; display:inline-block; }
  .sel-day select{ width:60px; }
  .sel::after{
    content:"▼"; position:absolute; right:8px; top:50%; transform:translateY(-52%);
    font-size:10px; color:var(--caret-color); pointer-events:none;
  }
  .unit{ font-weight:600; font-size:13px; color:#444; }

  /* 年＋月：ひとまとまりボックス（見えるラベル＋全面透明の month 入力） */
  .ym-box{
    position:relative; display:inline-block; text-align:left;
    border:1px solid var(--field-border); border-radius:var(--field-radius); background:#fff;
    /* “日”select と高さを揃えるために同じパディング感にする */
    padding:var(--field-pad-v) calc(var(--field-pad-h) + 18px) var(--field-pad-v) var(--field-pad-h);
    min-width:150px; /* 丸カードに収まる程度。必要ならここを詰めてOK */
  }
  .ym-label{
    font-size:var(--field-font-size);
    font-weight:var(--field-font-weight);
    color:var(--field-fg);
    user-select:none;
  }
  .ym-caret{
    position:absolute; right:8px; top:50%; transform:translateY(-50%);
    font-size:10px; color:var(--caret-color); pointer-events:none;
  }
  /* “見える箱”の全面に month 入力を重ねて、スマホで確実にホイールを出す */
  .ym-box input[type="month"]{
    position:absolute; inset:0; width:100%; height:100%;
    opacity:0; border:0; background:transparent; appearance:none; -webkit-appearance:none;
    cursor:pointer;
  }

  /* CHECKボタン */
  .btn{
    margin-top:10px; padding:12px 22px; font-size:16px; color:#fff; background:var(--brand);
    border:none; border-radius:999px; cursor:pointer; min-height:44px;
  }

  /* 結果エリア（高さ固定で動かないように） */
  .result{ margin-top:12px; font-size:26px; font-weight:700; min-height:32px; }
  .reading{ margin-top:0; font-size:12px; color:#444; min-height:16px; }

  /* カレンダーへボタン（丸カードの少し下） */
  .nav{ margin-top:4px; }
  .nav .to-calendar{
    text-decoration:none; font-size:14px; font-weight:600;
    background:var(--nav-btn-bg); color:var(--nav-btn-fg);
    padding:8px 14px; border-radius:999px; display:inline-block;
  }

  /* OFUSEボタン（画面いちばん下に小さく固定・距離はCSS変数で調整OK） */
  .support-footer{
    position:fixed; left:0; right:0; bottom:var(--support-offset); z-index:10; text-align:center;
  }
  .support-btn{
    text-decoration:none; font-size:12px; font-weight:600;
    color:#ff7f50; background:transparent; border:2px solid #ff7f50;
    padding:6px 10px; border-radius:10px; display:inline-block; opacity:.9;
  }
  @media (max-width:420px){
    .support-btn{ font-size:11px; padding:5px 9px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 class="logo">ilo.ilo</h1>
      <div class="sub">日干支 checker</div>

      <div class="row">
        <!-- 年月：ひと箱（中に「2025 年　9 ▼」表示。外に「月」） -->
        <span class="ym-box">
          <span class="ym-label" id="ymLabel">----</span>
          <span class="ym-caret">▼</span>
          <input type="month" id="ymInput" />
        </span>
        <span class="unit">月</span>

        <!-- 日：従来どおり -->
        <span class="sel sel-day"><select id="day"></select></span>
        <span class="unit">日</span>
      </div>

      <button class="btn" onclick="calculate()">CHECK!</button>

      <div class="result" id="result"></div>
      <div class="reading" id="reading"></div>
    </div>

    <div class="nav">
      <a class="to-calendar" href="calendar.html" rel="noopener">日干支カレンダーへ →</a>
    </div>
  </div>

  <div class="support-footer">
    <a class="support-btn" href="https://ofuse.me/izuiloilo" target="_blank" rel="noopener">izuを応援する</a>
  </div>

<script>
  /* 干支データ（そのまま） */
  const stems = ["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];
  const stemsReading = ["きのえ","きのと","ひのえ","ひのと","つちのえ","つちのと","かのえ","かのと","みずのえ","みずのと"];
  const branches = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
  const branchesReading = ["ね","うし","とら","う","たつ","み","うま","ひつじ","さる","とり","いぬ","い"];

  const baseDate  = new Date(1984, 2, 31); // 3/31 甲子
  function kanshiIndexFromDate(date){
    const diffDays = Math.floor((date - baseDate) / (1000*60*60*24));
    return (diffDays % 60 + 60) % 60;
  }

  /* DOM */
  const ymInput = document.getElementById('ymInput');
  const ymLabel = document.getElementById('ymLabel');
  const daySel  = document.getElementById('day');

  /* 内部状態：年・月（1-12） */
  let curYear, curMonth;

  /* “日”の選択肢を月ごとに更新 */
  function updateDays(){
    const last = new Date(curYear, curMonth, 0).getDate();
    const keep = +daySel.value || 1;
    daySel.innerHTML = '';
    for(let d=1; d<=last; d++){ daySel.add(new Option(d, d)); }
    daySel.value = Math.min(keep, last);
  }

  /* 年月ラベル（箱内の表示）を更新：「2025 年  9」 */
  function updateYmLabel(){
    ymLabel.textContent = `${curYear} 年  ${curMonth}`;
  }

  /* 計算（CHECK!で実行） */
  function calculate(){
    const d = +daySel.value;
    if(!curYear || !curMonth || !d) return;
    const date = new Date(curYear, curMonth-1, d);
    const idx  = kanshiIndexFromDate(date);
    const stem=stems[idx%10], branch=branches[idx%12];
    const stemR=stemsReading[idx%10], branchR=branchesReading[idx%12];
    document.getElementById('result').textContent  = stem + branch;
    document.getElementById('reading').textContent = stemR + branchR;
  }

  /* month 入力：変更で即 年・月 を反映（iOSで年・月ホイール） */
  function supportsMonth(){
    const i = document.createElement('input');
    i.setAttribute('type','month');
    return i.type === 'month';
  }
  if(supportsMonth()){
    ymInput.addEventListener('change', ()=>{
      if(!ymInput.value) return;                  // "YYYY-MM"
      const [y,m] = ymInput.value.split('-').map(v=>+v);
      curYear = y; curMonth = m;
      updateYmLabel(); updateDays();
    });
  }else{
    /* 旧環境フォールバック（テキストで YYYY-MM） */
    ymInput.type = 'text';
    ymInput.placeholder = 'YYYY-MM';
    ymInput.addEventListener('change', ()=>{
      const v = ymInput.value.trim();
      const ok = /^\d{4}-(0[1-9]|1[0-2])$/.test(v);
      if(ok){
        const [y,m] = v.split('-').map(v=>+v);
        curYear = y; curMonth = m;
        updateYmLabel(); updateDays();
      }
    });
  }

  /* 初期：今日をセット → ラベルと“日”を更新 → 結果も表示 */
  (function(){
    const t=new Date();
    curYear = t.getFullYear();
    curMonth = t.getMonth()+1;
    updateYmLabel();
    if(supportsMonth()){
      ymInput.value = `${curYear}-${String(curMonth).padStart(2,'0')}`;
    }
    for(let d=1; d<=31; d++){ daySel.add(new Option(d, d)); }
    updateDays();
    daySel.value = t.getDate();
    calculate();
  })();

  /* “日“変更時：結果はCHECK!で */
  daySel.addEventListener('change', ()=>{ /* no-op */ });
</script>
</body>
</html>
